version: "1.0"
project_name: "payment-gateway-async"

setup:
  - "echo 'Setting up environment...'"
  - "docker-compose build"

start:
  - "docker-compose up -d"
  - "echo 'Waiting for services to stabilize...'"
  - "sleep 20" 

verify:
  # 1. API Health Check
  - "curl -f http://localhost:8000/health || exit 1"
  
  # 2. Verify Job Queue (Redis + Worker Status)
  - "curl -f http://localhost:8000/api/v1/test/jobs/status || exit 1"
  
  # 3. Verify Dashboard Access
  - "curl -f http://localhost:3000 || exit 1"
  
  # 4. Verify Checkout Access
  - "curl -f http://localhost:3001 || exit 1"

test:
  # Run the webhook test receiver (runs in background for 10s then exits)
  - "timeout 10s node webhook-test.js &"

shutdown:
  - "docker-compose down -v"